{"version":3,"sources":["components/Texts/Texts.ts","components/Button/style.ts","components/Button/Button.tsx","components/WizardButtons/style.ts","components/WizardButtons/WizardButtons.tsx","helper/audio/encoder-wav-worker.js","helper/audio/encoder-mp3-worker.js","helper/audio/encoder-flac-worker.js","helper/audio/RecorderService.js","modals/RecordErrorModal/style.ts","modals/RecordErrorModal/RecordErrorModal.tsx","assets/icons/start.svg","components/MicRecorder/style.ts","components/MicRecorder/MicRecorder.tsx","assets/icons/upload.svg","containers/SubmitSteps/RecordingsSteps/Introduction/Record/Record.tsx","assets/icons/stop.svg","containers/SubmitSteps/RecordingsSteps/Introduction/Record/style.ts","helper/fileHelper.ts","helper/getDuration.ts"],"names":["BaseText","css","BlackText","styled","div","_ref","dark","colors","darkBlack","black","props","fontSize","BaseTitle","StyledButton","button","disabled","color","purple_50","purple","white","Button","React","memo","children","_jsx","type","WizardButtonsContainer","theme","layout","generalPaddingAmount","breakpoints","tablet","WizardButtons","invert","leftLabel","leftDisabled","leftHandler","rightLabel","rightDisabled","rightHandler","_jsxs","onClick","recorded","this","onmessage","e","data","buffer","length","Uint8Array","i","index","sample","push","encode","sampleRate","bufferLength","wav","view","DataView","setUint32","setUint16","CHANNELS","set","msg","postMessage","dump","close","mp3encoder","maxSamples","mp3Data","convertBuffer","arrayBuffer","Float32Array","out","Int16Array","input","output","s","Math","max","min","floatTo16BitPCM","opts","samplesMono","remaining","left","subarray","encodeBuffer","mp3buf","flush","importScripts","baseUrl","lamejs","Mp3Encoder","flacEncoder","SAMPLERATE","COMPRESSION","BPS","flacOk","flacLength","flacBuffers","INIT","wavBuffers","writeCallbackFn","bytes","byteLength","initFlac","Flac","init_libflac_encoder","statusEncoder","init_encoder_stream","console","log","error","doEncodeFlac","audioData","bufLength","bufferI32","Uint32Array","setInt32","flacReturn","FLAC__stream_encoder_process_interleaved","exportFlacFile","recBuffers","recLength","samples","channelBuffer","recordingLength","result","offset","lng","mergeBuffersUint8","Blob","config","finalConfig","bps","channels","samplerate","compression","isReady","onready","setTimeout","init","len","buffered","splice","info","encodeFlac","FLAC__stream_encoder_finish","FLAC__stream_encoder_delete","RecorderService","constructor","cleanup","onRecording","em","removeEventListener","recordingFn","onAudioProcesss","onAudioProcessFn","createWorker","fn","js","toString","replace","blob","Worker","URL","createObjectURL","startRecording","timeslice","state","navigator","mediaDevices","getUserMedia","audioCtx","AudioContext","micGainNode","createGain","outputGainNode","createDynamicsCompressorNode","dynamicsCompressorNode","createDynamicsCompressor","createAnalyserNode","analyserNode","createAnalyser","forceScriptProcessor","broadcastAudioProcessEvents","usingMediaRecorder","processorNode","createScriptProcessor","processorBufferSize","createMediaStreamDestination","destinationNode","destination","manualEncoderId","encoderWorker","EncoderMp3","process","encoderMimeType","EncoderFlac","EncoderWav","addEventListener","event","Event","_onDataAvailable","userMediaConstraints","audio","echoCancellation","enableEchoCancellation","deviceId","then","stream","_startRecordingWithStream","catch","setMicGain","newGain","micGain","gain","setValueAtTime","currentTime","micAudioStream","inputStreamNode","createMediaStreamSource","context","onGraphSetupWithInputStream","connect","nextNode","onaudioprocess","_onAudioProcess","mediaRecorder","MediaRecorder","mimeType","evt","_onError","start","slicing","setInterval","dispatchEvent","CustomEvent","detail","inputBuffer","outputBuffer","getChannelData","stopRecording","stop","clearInterval","chunks","chunkType","blobUrl","recording","ts","Date","getTime","size","disconnect","stopTracksAndCloseCtxWhenFinished","getTracks","forEach","track","window","webkitAudioContext","document","createDocumentFragment","undefined","onAudioPress","ModalBody","ModalTitle","ModalContent","Modal","setAppElement","RecordErrorModal","modalTitle","onConfirm","t","useTranslation","style","content","height","maxWidth","margin","borderRadius","border","overlay","backgroundColor","className","MicRecorderContainer","MicButtonsContainer","MicButtonWithText","MicNote","p","lightDarkGray","MicRecorderButton","opacity","MicRecorderImage","img","MicRecorderStartImage","MicRecorderStopImage","MicRecorderTimerContainer","MicRecorderTimerReleaseTextContainer","red","MicRecorderTextP","show","baseConfig","MicRecorder","maxTimeInSeconds","onNewRecord","delay","recordingFile","recordingService","useRef","audioSamples","timerRef","timeout","target","micAllowed","setMicAllowed","useState","recordingInProgress","setRecordingInProgress","showReleaseText","setShowReleaseText","showShortRecordingText","setShowShortRecordingText","longPressTriggered","setLongPressTriggered","onAudioProcess","useCallback","current","channel","numberOfChannels","inputData","outputData","onNewRecording","async","fetch","r","fileName","file","FileHelper","blobToFile","humanReadableSize","sizeAsHuman","useEffect","Audio","load","listenerFn","getDuration","_timerRef$current","setTime","handleStartRecording","_timerRef$current2","reset","handleStopRecording","handleFormatValue","value","preventDefault","handleStartLongPress","passive","handleEndLongPress","clearTimeout","isOpen","Timer","ref","startImmediately","checkpoints","time","callback","Minutes","Seconds","formatValue","onMouseDown","onMouseUp","onTouchStart","onTouchEnd","onMouseLeave","src","StartSVG","alt","StopSVG","schema","Yup","required","test","Promise","resolver","duration","Infinity","remove","volume","play","defined","Record","onNext","onManualUpload","defaultValues","currentLogic","action","Portal","usePortal","bindTo","getElementById","handleSubmit","control","getValues","formState","useForm","mode","yupResolver","isValid","micKey","_Fragment","MainContainer","MicContainer","Controller","name","render","_ref2","onChange","UploadContainer","onManualUploadWithFile","uploadedFile","UploadImage","UploadSVG","UploadText","Text","StopImg","attrs","si","thresh","abs","units","u","toFixed","theBlob","b","lastModifiedDate","isSafari","pause"],"mappings":"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","file":"static/js/4.9749f517.chunk.js","sourcesContent":["import styled, { css } from 'styled-components';\nimport { colors } from 'theme';\n\nexport const BaseText = css`\n  font-family: 'Source Sans Pro';\n  font-size: 0.875rem;\n  line-height: 20px;\n`;\n\nexport const BlackText = styled.div<{ dark?: boolean; fontSize?: string; }>`\n  ${BaseText}\n  color: ${({ dark }) => (dark ? colors.darkBlack : colors.black)};\n  ${props => (props.fontSize ? `font-size: ${props.fontSize};` : '')}\n`;\n\nexport const BaseTitle = styled.div`\n  font-family: 'Open Sans';\n  font-weight: 700;\n  font-size: 24px;\n  line-height: 1;\n  color: ${colors.darkBlack};\n`;\n","import styled from 'styled-components';\nimport { colors } from '../../theme';\n\nexport interface StyledButtonProps {\n  disabled?: boolean;\n  dark?: boolean;\n  id?: string;\n}\n\nexport const StyledButton = styled.button<StyledButtonProps>`\n  height: 52px;\n  border-radius: 15px; \n  font-family: 'Source Sans Pro'; /* It could be removed if default on body changes */\n  font-weight: bold;\n  font-size: 14px;\n  font-weight: bold;\n  width: 100%;\n\n  ${({ dark, disabled }) => {\n    const color = disabled ? colors.purple_50 : colors.purple;\n    return dark ? `\n    background-color: ${color};\n    color: ${colors.white};\n    border: none;\n  ` : `\n    background-color: ${colors.white};\n    color: ${color};\n    border: 1px solid ${color};\n  `;\n  }}\n`;\n","import React, { PropsWithChildren } from 'react';\n\n// Styles\nimport {\n  StyledButton,\n  StyledButtonProps,\n} from './style';\n\nexport interface ButtonProps extends PropsWithChildren<StyledButtonProps> {\n  onClick?: ((event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => void);\n}\n\nconst Button = React.memo(({ children, ...props }: ButtonProps) => ((\n  <StyledButton\n    type=\"button\"\n    {...props}\n  >\n    {children}\n  </StyledButton>\n)));\n\nexport default Button;\n","import styled from 'styled-components';\n\nexport const WizardButtonsContainer = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  max-width: ${props => `calc(100% - ${props.theme.layout.generalPaddingAmount * 2}px)`};\n  margin: 0 auto;\n\n  button {\n    flex: 1;\n\n    &:first-of-type {\n      margin-left: 0px !important;\n    }\n\n    &:last-of-type {\n      margin-left: 20px;\n    }\n  }\n\n  @media screen and (${props => props.theme.breakpoints.tablet}){\n    max-width: 470px;\n  }\n`;\n","/* eslint-disable react/require-default-props */\nimport React from 'react';\n\n// Components\nimport Button from 'components/Button';\n\n// Styles\nimport {\n  WizardButtonsContainer,\n} from './style';\n\ninterface WizardButtonsProps {\n  invert?: boolean;\n  leftLabel: string;\n  leftDisabled?: boolean;\n  leftHandler: () => void;\n  rightLabel?: string;\n  rightDisabled?: boolean;\n  rightHandler?: () => void;\n}\n\nconst WizardButtons = React.memo(({\n  invert = false,\n  leftLabel,\n  leftDisabled,\n  leftHandler,\n  rightLabel,\n  rightDisabled,\n  rightHandler,\n}: WizardButtonsProps) => (\n  <WizardButtonsContainer>\n    <Button\n      dark={invert}\n      disabled={leftDisabled}\n      onClick={leftHandler}\n    >\n      {leftLabel}\n    </Button>\n    {\n        rightLabel && rightHandler && (\n          <Button\n            dark={!invert}\n            disabled={rightDisabled}\n            onClick={rightHandler}\n          >\n            {rightLabel}\n          </Button>\n        )\n      }\n  </WizardButtonsContainer>\n));\nexport default React.memo(WizardButtons);\n","/* eslint-disable func-names */\nexport default function () {\n  // Parts copied from https://github.com/chris-rudmin/Recorderjs\n  const BYTES_PER_SAMPLE = 2;\n  const CHANNELS = 1; // 1=mono , 2=Stereo\n  let recorded = [];\n\n  function encode(buffer) {\n    const { length } = buffer;\n    const data = new Uint8Array(length * BYTES_PER_SAMPLE * CHANNELS);\n    for (let i = 0; i < length; i += 1) {\n      const index = i * BYTES_PER_SAMPLE * CHANNELS;\n      let sample = buffer[i];\n      if (sample > 1) {\n        sample = 1;\n      } else if (sample < -1) {\n        sample = -1;\n      }\n      sample *= 32768;\n      data[index] = sample;\n      // eslint-disable-next-line no-bitwise\n      data[index + 1] = sample >> 8;\n    }\n    recorded.push(data);\n  }\n\n  function dump(sampleRate) {\n    const bufferLength = recorded.length ? recorded[0].length : 0;\n    const length = recorded.length * bufferLength;\n    const wav = new Uint8Array(44 + length);\n\n    const view = new DataView(wav.buffer);\n\n    // RIFF identifier 'RIFF'\n    view.setUint32(0, 1380533830, false);\n    // file length minus RIFF identifier length and file description length\n    view.setUint32(4, 36 + length, true);\n    // RIFF type 'WAVE'\n    view.setUint32(8, 1463899717, false);\n    // format chunk identifier 'fmt '\n    view.setUint32(12, 1718449184, false);\n    // format chunk length\n    view.setUint32(16, 16, true);\n    // sample format (raw)\n    view.setUint16(20, 1, true);\n    // channel count\n    view.setUint16(22, CHANNELS, true);\n    // sample rate\n    view.setUint32(24, sampleRate, true); // 44100 Khz\n    // byte rate (channels * sample rate * block align)\n    view.setUint32(28, CHANNELS * sampleRate * BYTES_PER_SAMPLE, true); // kbps = 1411\n    // block align (channel count * bytes per sample)\n    view.setUint16(32, CHANNELS * BYTES_PER_SAMPLE, true);\n    // bits per sample\n    view.setUint16(34, 8 * BYTES_PER_SAMPLE, true); // 16\n    // data chunk identifier 'data'\n    view.setUint32(36, 1684108385, false);\n    // data chunk length\n    view.setUint32(40, length, true);\n\n    for (let i = 0; i < recorded.length; i += 1) {\n      wav.set(recorded[i], i * bufferLength + 44);\n    }\n\n    recorded = [];\n    const msg = [wav.buffer];\n    postMessage(msg, [msg[0]]);\n  }\n\n  this.onmessage = e => {\n    if (e.data[0] === 'encode') {\n      encode(e.data[1]);\n    } else if (e.data[0] === 'dump') {\n      dump(e.data[1]);\n    } else if (e.data[0] === 'close') {\n      this.close();\n    }\n  };\n}\n","/* eslint-disable func-names */\n// import 'babel-polyfill'\n// import lamejs from 'lamejs';\n\nexport default function () {\n  // Note that relative paths don't work when loaded as a blob\n  // https://stackoverflow.com/questions/22172426/using-importsscripts-within-blob-in-a-karma-environment\n  // importScripts('https://localhost:8443/workers/encoders/lame.js') // eslint-disable-line\n\n  const channels = 1; // 1 for mono or 2 for stereo\n  // let sampleRate = 44100 // 44.1khz (normal mp3 samplerate)\n  const kbps = 128; // encode 128kbps mp3\n\n  let mp3encoder = null;\n\n  const maxSamples = 1152;\n\n  let mp3Data = []; // array of Uint8Array\n\n  function init(opts) {\n    /* global lamejs */\n    importScripts(opts.baseUrl + '/workers/encoders/lame.min.js'); // eslint-disable-line\n    mp3encoder = new lamejs.Mp3Encoder(channels, opts.sampleRate, kbps);\n  }\n\n  function floatTo16BitPCM(input, output) {\n    for (let i = 0; i < input.length; i += 1) {\n      const s = Math.max(-1, Math.min(1, input[i]));\n      // eslint-disable-next-line no-param-reassign\n      output[i] = (s < 0 ? s * 0x8000 : s * 0x7FFF);\n    }\n  }\n\n  function convertBuffer(arrayBuffer) {\n    const data = new Float32Array(arrayBuffer);\n    const out = new Int16Array(arrayBuffer.length);\n    floatTo16BitPCM(data, out);\n    return out;\n  }\n\n  function encode(arrayBuffer) {\n    const samplesMono = convertBuffer(arrayBuffer);\n    let remaining = samplesMono.length;\n    for (let i = 0; remaining >= 0; i += maxSamples) {\n      const left = samplesMono.subarray(i, i + maxSamples);\n      const data = mp3encoder.encodeBuffer(left);\n      mp3Data.push(data);\n      remaining -= maxSamples;\n    }\n\n    // var mp3buf = mp3encoder.encodeBuffer(buffer)\n    // if (mp3buf.length > 0) {\n    //   mp3Data.push(mp3buf)\n    // }\n  }\n\n  function dump() {\n    const mp3buf = mp3encoder.flush();\n    if (mp3buf.length > 0) {\n      mp3Data.push(mp3buf);\n    }\n\n    // Probably results in native memory copy\n    postMessage(mp3Data);\n\n    // Would like to do this, but not possible because mp3Data is generic array of Uint8Array, and generic\n    // arrays are not transferrable types.\n    // postMessage(mp3Data, [mp3Data])\n\n    // This might help if/when ever become available again\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer/transfer\n\n    // For now, though, we have not other option except to build a complete copy in javascript. This means\n    // we temporarily require twice the memory of whatever was recorded.\n\n    mp3Data = [];\n  }\n\n  onmessage = function onmessage(e) {\n    if (e.data[0] === 'encode') {\n      encode(e.data[1]);\n    } else if (e.data[0] === 'dump') {\n      dump(e.data[1]);\n    } else if (e.data[0] === 'init') {\n      init(e.data[1]);\n    } else if (e.data[0] === 'close') {\n      this.close();\n    }\n  };\n}\n","/* eslint-disable */\n/* eslint-disable func-names */\n/* global Flac */\n\nexport default function () {\n  const workersHost = process.env.PUBLIC_URL || process.env.REACT_APP_WORKERS_HOST || 'https://virufy.org/demo';\n  importScripts(`${workersHost}/workers/encoders/libflac.dev.js`); // eslint-disable-line\n\n  let flacEncoder;\n  let CHANNELS = 1;\n  let SAMPLERATE = 44100;\n  let COMPRESSION = 5;\n  let BPS = 16;\n  let flacOk = 1;\n  let flacLength = 0;\n  const flacBuffers = [];\n  let INIT = false;\n  const wavBuffers = [];\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  function writeCallbackFn(buffer, bytes) {\n    flacBuffers.push(buffer);\n    flacLength += buffer.byteLength;\n  }\n\n  // HELPER: handle initialization of flac encoder\n  function initFlac() {\n    flacEncoder = Flac.init_libflac_encoder(SAMPLERATE, CHANNELS, BPS, COMPRESSION, 0);\n    /// /\n    if (flacEncoder !== 0) {\n      const statusEncoder = Flac.init_encoder_stream(flacEncoder, writeCallbackFn);\n      flacOk &= (statusEncoder == 0);\n\n      console.log(`flac init     : ${flacOk}`);// DEBUG\n      console.log(`status encoder: ${statusEncoder}`);// DEBUG\n\n      INIT = true;\n    } else {\n      console.error('Error initializing the encoder.');\n    }\n  }\n\n  function init(config) {\n    let finalConfig = config;\n\n    if (!finalConfig) {\n      finalConfig = {\n        bps: BPS, channels: CHANNELS, samplerate: SAMPLERATE, compression: COMPRESSION,\n      };\n    }\n\n    finalConfig.channels = finalConfig.channels ? finalConfig.channels : CHANNELS;\n    finalConfig.samplerate = finalConfig.samplerate ? finalConfig.samplerate : SAMPLERATE;\n    finalConfig.bps = finalConfig.bps ? finalConfig.bps : BPS;\n    finalConfig.compression = finalConfig.compression ? finalConfig.compression : COMPRESSION;\n\n    /// /\n    COMPRESSION = finalConfig.compression;\n    BPS = finalConfig.bps;\n    SAMPLERATE = finalConfig.samplerate;\n    CHANNELS = finalConfig.channels;\n    /// /\n\n    if (!Flac.isReady()) {\n      Flac.onready = function () {\n        setTimeout(() => {\n          initFlac();\n        }, 0);\n      };\n    } else {\n      initFlac();\n    }\n  }\n\n  // HELPER: actually encode PCM data to Flac\n  function doEncodeFlac(audioData) {\n    const bufLength = audioData.length;\n    const bufferI32 = new Uint32Array(bufLength);\n    const view = new DataView(bufferI32.buffer);\n    const volume = 1;\n    let index = 0;\n    for (let i = 0; i < bufLength; i += 1) {\n      view.setInt32(index, (audioData[i] * (0x7FFF * volume)), true);\n      index += 4;\n    }\n\n    const flacReturn = Flac.FLAC__stream_encoder_process_interleaved(\n      flacEncoder, bufferI32, bufferI32.length / CHANNELS,\n    );\n    if (flacReturn != true) {\n      console.log(`Error: encode_buffer_pcm_as_flac returned false. ${flacReturn}`);\n    }\n  }\n\n  // HELPER: handle incoming PCM audio data for Flac encoding:\n  function encodeFlac(audioData) {\n    if (!Flac.isReady()) {\n      // if Flac is not ready yet: buffer the audio\n      wavBuffers.push(audioData);\n      console.info('buffered audio data for Flac encdoing');\n    } else {\n      if (wavBuffers.length > 0) {\n        // if there is buffered audio: encode buffered first (and clear buffer)\n\n        const len = wavBuffers.length;\n        const buffered = wavBuffers.splice(0, len);\n        // eslint-disable-next-line no-plusplus\n        for (let i = 0; i < len; ++i) {\n          doEncodeFlac(buffered[i]);\n        }\n      }\n\n      doEncodeFlac(audioData);\n    }\n  }\n\n  function mergeBuffersUint8(channelBuffer, recordingLength) {\n    const result = new Uint8Array(recordingLength);\n    let offset = 0;\n    const lng = channelBuffer.length;\n    for (let i = 0; i < lng; i += 1) {\n      const buffer = channelBuffer[i];\n      result.set(buffer, offset);\n      offset += buffer.length;\n    }\n    return result;\n  }\n\n  function exportFlacFile(recBuffers, recLength) {\n    // convert buffers into one single buffer\n    const samples = mergeBuffersUint8(recBuffers, recLength);\n\n    // var audioBlob = new Blob([samples], { type: type });\n    const theBlob = new Blob([samples], { type: 'audio/flac' });\n    return theBlob;\n  }\n\n  /*\n   * clear recording buffers\n   */\n  function clear() {\n    flacBuffers.splice(0, flacBuffers.length);\n    flacLength = 0;\n    wavBuffers.splice(0, wavBuffers.length);\n  }\n\n  this.onmessage = function onmessage(e) {\n    if (e.data[0] === 'init') {\n      init(e.data[1]);\n    } else if (e.data[0] === 'encode') {\n      encodeFlac(e.data[1]);\n    } else if (e.data[0] === 'dump') {\n      let data;\n      if (!Flac.isReady()) {\n        console.error('Flac was not initialized: could not encode data!');\n      } else {\n        flacOk &= Flac.FLAC__stream_encoder_finish(flacEncoder);\n        console.log(`flac finish: ${flacOk}`);// DEBUG\n        data = exportFlacFile(flacBuffers, flacLength);\n\n        Flac.FLAC__stream_encoder_delete(flacEncoder);\n      }\n\n      clear();\n\n      postMessage(data);\n      INIT = false;\n    }\n  };\n}\n","/* eslint-disable max-len */\n/* eslint-disable consistent-return */\n/* eslint-disable no-underscore-dangle */\n// Vendor Library https://github.com/mogwai/pwa-audio-recorder/tree/master\n\nimport EncoderWav from './encoder-wav-worker';\nimport EncoderMp3 from './encoder-mp3-worker';\nimport EncoderFlac from './encoder-flac-worker';\n// import EncoderOgg from './encoder-ogg-worker';\n\nexport default class RecorderService {\n  constructor(config) {\n    window.AudioContext = window.AudioContext || window.webkitAudioContext;\n\n    this.em = document.createDocumentFragment();\n\n    this.state = 'inactive';\n\n    this.chunks = [];\n    this.chunkType = '';\n\n    this.encoderMimeType = 'audio/wav';\n\n    this.config = {\n      broadcastAudioProcessEvents: config.broadcastAudioProcessEvents !== undefined ? config.broadcastAudioProcessEvents : false,\n      createAnalyserNode: config.createAnalyserNode !== undefined ? config.createAnalyserNode : false,\n      createDynamicsCompressorNode: config.createDynamicsCompressorNode !== undefined ? config.createDynamicsCompressorNode : false,\n      forceScriptProcessor: config.forceScriptProcessor !== undefined ? config.forceScriptProcessor : false,\n      manualEncoderId: config.manualEncoderId !== undefined ? config.manualEncoderId : 'wav',\n      micGain: config.micGain !== undefined ? config.micGain : 1.0,\n      processorBufferSize: config.processorBufferSize !== undefined ? config.processorBufferSize : 2048,\n      stopTracksAndCloseCtxWhenFinished: config.stopTracksAndCloseCtxWhenFinished !== undefined ? config.stopTracksAndCloseCtxWhenFinished : true,\n      usingMediaRecorder: config.usingMediaRecorder !== undefined ? config.usingMediaRecorder : typeof window.MediaRecorder !== 'undefined',\n      enableEchoCancellation: config.enableEchoCancellation !== undefined ? config.enableEchoCancellation : true,\n      sampleRate: config.sampleRate !== undefined ? config.sampleRate : 44100,\n      onRecording: config.onRecording,\n      onAudioPress: config.onAudioPress,\n    };\n\n    if (config.onRecording) {\n      this.recordingFn = evt => config.onRecording(evt);\n      this.em.addEventListener('recording', this.recordingFn);\n    }\n    if (config.onAudioProcesss) {\n      this.onAudioProcessFn = evt => config.onAudioProcesss(evt);\n      this.em.addEventListener('onaudioprocess', this.onAudioProcessFn);\n    }\n  }\n\n  cleanup = () => {\n    if (this.config.onRecording) {\n      this.em.removeEventListener('recording', this.recordingFn);\n    }\n    if (this.config.onAudioProcesss) {\n      this.em.removeEventListener('onaudioprocess', this.onAudioProcessFn);\n    }\n  };\n\n  createWorker = fn => {\n    const js = fn\n      .toString()\n      .replace(/^function\\s*\\(\\)\\s*{/, '')\n      .replace(/}$/, '');\n    const blob = new Blob([js]);\n    return new Worker(URL.createObjectURL(blob));\n  };\n\n  startRecording = timeslice => {\n    if (this.state !== 'inactive') {\n      return;\n    }\n\n    // This is the case on ios/chrome, when clicking links from within ios/slack (sometimes), etc.\n    if (\n      !navigator\n      || !navigator.mediaDevices\n      || !navigator.mediaDevices.getUserMedia\n    ) {\n      // alert('Missing support for navigator.mediaDevices.getUserMedia'); // temp: helps when testing for strange issues on ios/safari\n      return;\n    }\n\n    this.audioCtx = new AudioContext({\n      sampleRate: this.config.sampleRate,\n    });\n    this.micGainNode = this.audioCtx.createGain();\n    this.outputGainNode = this.audioCtx.createGain();\n\n    if (this.config.createDynamicsCompressorNode) {\n      this.dynamicsCompressorNode = this.audioCtx.createDynamicsCompressor();\n    }\n\n    if (this.config.createAnalyserNode) {\n      this.analyserNode = this.audioCtx.createAnalyser();\n    }\n\n    // If not using MediaRecorder(i.e. safari and edge), then a script processor is required. It's optional\n    // on browsers using MediaRecorder and is only useful if wanting to do custom analysis or manipulation of\n    // recorded audio data.\n    if (\n      this.config.forceScriptProcessor\n      || this.config.broadcastAudioProcessEvents\n      || !this.config.usingMediaRecorder\n    ) {\n      this.processorNode = this.audioCtx.createScriptProcessor(\n        this.config.processorBufferSize,\n        1,\n        1,\n      ); // TODO: Get the number of channels from mic\n    }\n\n    // Create stream destination on chrome/firefox because, AFAICT, we have no other way of feeding audio graph output\n    // in to MediaRecorderSafari/Edge don't have this method as of 2018-04.\n    if (this.audioCtx.createMediaStreamDestination) {\n      this.destinationNode = this.audioCtx.createMediaStreamDestination();\n    } else {\n      this.destinationNode = this.audioCtx.destination;\n    }\n\n    // Create web worker for doing the encoding\n    if (!this.config.usingMediaRecorder) {\n      if (this.config.manualEncoderId === 'mp3') {\n        this.encoderWorker = this.createWorker(EncoderMp3);\n        const baseUrl = process.env.PUBLIC_URL || 'https://virufy.org/demo';\n        this.encoderWorker.postMessage([\n          'init',\n          { baseUrl, sampleRate: this.audioCtx.sampleRate },\n        ]);\n        this.encoderMimeType = 'audio/mpeg';\n      } else if (this.config.manualEncoderId === 'flac') {\n        this.encoderWorker = this.createWorker(EncoderFlac);\n        this.encoderWorker.postMessage([\n          'init',\n          { sampleRate: this.audioCtx.sampleRate },\n        ]);\n        this.encoderMimeType = 'audio/flac';\n      } else {\n        this.encoderWorker = this.createWorker(EncoderWav);\n        this.encoderMimeType = 'audio/wav';\n      }\n      this.encoderWorker.addEventListener('message', e => {\n        const event = new Event('dataavailable');\n        if (this.config.manualEncoderId === 'ogg' || this.config.manualEncoderId === 'flac') {\n          event.data = e.data;\n        } else {\n          event.data = new Blob(e.data, { type: this.encoderMimeType });\n        }\n        this._onDataAvailable(event);\n      });\n    }\n\n    // Setup media constraints\n    const userMediaConstraints = {\n      audio: {\n        echoCancellation: this.config.enableEchoCancellation,\n      },\n    };\n    if (this.config.deviceId) {\n      userMediaConstraints.audio.deviceId = this.config.deviceId;\n    }\n\n    // This will prompt user for permission if needed\n    return navigator.mediaDevices\n      .getUserMedia(userMediaConstraints)\n      .then(stream => {\n        this._startRecordingWithStream(stream, timeslice);\n      })\n      .catch(error => {\n        // alert(`Error with getUserMedia: ${error.message}`); // temp: helps when testing for strange issues on ios/safari\n        console.log(error);\n      });\n  };\n\n  setMicGain = newGain => {\n    this.config.micGain = newGain;\n    if (this.audioCtx && this.micGainNode) {\n      this.micGainNode.gain.setValueAtTime(newGain, this.audioCtx.currentTime);\n    }\n  };\n\n  _startRecordingWithStream = (stream, timeslice) => {\n    this.micAudioStream = stream;\n\n    this.inputStreamNode = this.audioCtx.createMediaStreamSource(\n      this.micAudioStream,\n    );\n    this.audioCtx = this.inputStreamNode.context;\n\n    // Kind-of a hack to allow hooking in to audioGraph inputStreamNode\n    if (this.onGraphSetupWithInputStream) {\n      this.onGraphSetupWithInputStream(this.inputStreamNode);\n    }\n\n    this.inputStreamNode.connect(this.micGainNode);\n    this.micGainNode.gain.setValueAtTime(\n      this.config.micGain,\n      this.audioCtx.currentTime,\n    );\n\n    let nextNode = this.micGainNode;\n    if (this.dynamicsCompressorNode) {\n      this.micGainNode.connect(this.dynamicsCompressorNode);\n      nextNode = this.dynamicsCompressorNode;\n    }\n\n    this.state = 'recording';\n\n    if (this.processorNode) {\n      nextNode.connect(this.processorNode);\n      this.processorNode.connect(this.outputGainNode);\n      this.processorNode.onaudioprocess = e => this._onAudioProcess(e);\n    } else {\n      nextNode.connect(this.outputGainNode);\n    }\n\n    if (this.analyserNode) {\n      // TODO: If we want the analyser node to receive the processorNode's output, this needs to be changed _and_\n      //       processor node needs to be modified to copy input to output. It currently doesn't because it's not\n      //       needed when doing manual encoding.\n      // this.processorNode.connect(this.analyserNode)\n      nextNode.connect(this.analyserNode);\n    }\n\n    this.outputGainNode.connect(this.destinationNode);\n\n    if (this.config.usingMediaRecorder) {\n      this.mediaRecorder = new MediaRecorder(this.destinationNode.stream, { mimeType: this.encoderMimeType || 'audio/wav' });\n      this.mediaRecorder.addEventListener('dataavailable', evt => this._onDataAvailable(evt));\n      this.mediaRecorder.addEventListener('error', evt => this._onError(evt));\n\n      this.mediaRecorder.start(timeslice);\n    } else {\n      // Output gain to zero to prevent feedback. Seems to matter only on Edge, though seems like should matter\n      // on iOS too.  Matters on chrome when connecting graph to directly to audioCtx.destination, but we are\n      // not able to do that when using MediaRecorder.\n      this.outputGainNode.gain.setValueAtTime(0, this.audioCtx.currentTime);\n      // this.outputGainNode.gain.value = 0\n\n      // Todo: Note that time slicing with manual wav encoderWav won't work. To allow it would require rewriting the encoderWav\n      // to assemble all chunks at end instead of adding header to each chunk.\n      if (timeslice) {\n        console.log(\n          'Time slicing without MediaRecorder is not yet supported. The resulting recording will not be playable.',\n        );\n        this.slicing = setInterval(function anon() {\n          if (this.state === 'recording') {\n            this.encoderWorker.postMessage(['dump', this.context.sampleRate]);\n          }\n        }, timeslice);\n      }\n    }\n  };\n\n  _onAudioProcess = e => {\n    // console.log('onaudioprocess', e)\n    // let inputBuffer = e.inputBuffer\n    // let outputBuffer = e.outputBuffer\n    // console.log(this.micAudioStream)\n    // console.log(this.audioCtx)\n    // console.log(this.micAudioStream.getTracks().forEach((track) => console.log(track)))\n\n    // this.onAudioEm.dispatch(new Event('onaudioprocess', {inputBuffer:inputBuffer,outputBuffer:outputBuffer}))\n\n    if (this.config.broadcastAudioProcessEvents) {\n      this.em.dispatchEvent(\n        new CustomEvent('onaudioprocess', {\n          detail: {\n            inputBuffer: e.inputBuffer,\n            outputBuffer: e.outputBuffer,\n          },\n        }),\n      );\n    }\n\n    // // Example handling:\n    // let inputBuffer = e.inputBuffer\n    // let outputBuffer = e.outputBuffer\n    // // Each channel (usually only one)\n    // for (let channel = 0; channel < outputBuffer.numberOfChannels; channel++) {\n    //   let inputData = inputBuffer.getChannelData(channel)\n    //   let outputData = outputBuffer.getChannelData(channel)\n    //\n    //   // Each sample\n    //   for (let sample = 0; sample < inputBuffer.length; sample++) {\n    //     // Make output equal to the same as the input (thus processor is doing nothing at this time)\n    //     outputData[sample] = inputData[sample]\n    //   }\n    // }\n\n    // When manually encoding (safari/edge), there's no reason to copy data to output buffer.  We set the output\n    // gain to 0 anyways (which is required on Edge if we did copy data to output). However, if using a MediaRecorder\n    // and a processor (all other browsers), then it would be required to copy the data otherwise the graph would\n    // generate no data for the MediaRecorder to consume.\n    // if (this.forceScriptProcessor) {\n\n    // // Copy input to output\n    // let inputBuffer = e.inputBuffer\n    // let outputBuffer = e.outputBuffer\n    // // This doesn't work on iOS/Safari. Guessing it doesn't have copyToChannel support, but haven't verified.\n    // for (let channel = 0; channel < outputBuffer.numberOfChannels; channel++) {\n    //   outputBuffer.copyToChannel(inputBuffer.getChannelData(channel), channel)\n    // }\n\n    // Safari and Edge require manual encoding via web worker. Single channel only for now.\n    // Example stereo encoderWav: https://github.com/MicrosoftEdge/Demos/blob/master/microphone/scripts/recorderworker.js\n    if (!this.config.usingMediaRecorder) {\n      if (this.state === 'recording') {\n        if (this.config.broadcastAudioProcessEvents) {\n          this.encoderWorker.postMessage([\n            'encode',\n            e.outputBuffer.getChannelData(0),\n          ]);\n        } else {\n          this.encoderWorker.postMessage([\n            'encode',\n            e.inputBuffer.getChannelData(0),\n          ]);\n        }\n      }\n    }\n  };\n\n  stopRecording = () => {\n    if (this.state === 'inactive') {\n      return;\n    }\n    if (this.config.usingMediaRecorder) {\n      this.state = 'inactive';\n      this.mediaRecorder.stop();\n    } else {\n      this.state = 'inactive';\n      this.encoderWorker.postMessage(['dump', this.audioCtx.sampleRate]);\n      clearInterval(this.slicing);\n\n      // TODO: There should be a more robust way to handle this\n      // Without something like this, I think  the last recorded sample could be lost due to timing\n      // setTimeout(() => {\n      //   this.state = 'inactive'\n      //   this.encoderWorker.postMessage(['dump', this.audioCtx.sampleRate])\n      // }, 100)\n    }\n  };\n\n  _onDataAvailable = evt => {\n    // console.log('state', this.mediaRecorder.state)\n    // console.log('evt.data', evt.data)\n\n    this.chunks.push(evt.data);\n    this.chunkType = evt.data.type;\n\n    if (this.state !== 'inactive') {\n      return;\n    }\n\n    const blob = new Blob(this.chunks, { type: this.chunkType });\n    const blobUrl = URL.createObjectURL(blob);\n    const recording = {\n      ts: new Date().getTime(),\n      blobUrl,\n      mimeType: blob.type,\n      size: blob.size,\n    };\n\n    this.chunks = [];\n    this.chunkType = null;\n\n    if (this.destinationNode) {\n      this.destinationNode.disconnect();\n      this.destinationNode = null;\n    }\n    if (this.outputGainNode) {\n      this.outputGainNode.disconnect();\n      this.outputGainNode = null;\n    }\n    if (this.analyserNode) {\n      this.analyserNode.disconnect();\n      this.analyserNode = null;\n    }\n    if (this.processorNode) {\n      this.processorNode.disconnect();\n      this.processorNode = null;\n    }\n    if (this.encoderWorker) {\n      this.encoderWorker.postMessage(['close']);\n      this.encoderWorker = null;\n    }\n    if (this.dynamicsCompressorNode) {\n      this.dynamicsCompressorNode.disconnect();\n      this.dynamicsCompressorNode = null;\n    }\n    if (this.micGainNode) {\n      this.micGainNode.disconnect();\n      this.micGainNode = null;\n    }\n    if (this.inputStreamNode) {\n      this.inputStreamNode.disconnect();\n      this.inputStreamNode = null;\n    }\n\n    if (this.config.stopTracksAndCloseCtxWhenFinished) {\n      // This removes the red bar in iOS/Safari\n      this.micAudioStream.getTracks().forEach(track => track.stop());\n      this.micAudioStream = null;\n\n      this.audioCtx.close();\n      this.audioCtx = null;\n    }\n\n    this.em.dispatchEvent(\n      new CustomEvent('recording', { detail: { recording } }),\n    );\n  };\n\n  _onError = evt => {\n    console.log('error', evt);\n    this.em.dispatchEvent(new Event('error'));\n    // alert(`error:${evt}`); // for debugging purposes\n  };\n}\n","import styled from 'styled-components';\n\nexport const ModalBody = styled.div`\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n\n  @media screen and (${props => props.theme.breakpoints.tablet}) {\n    margin: auto;\n`;\n\nexport const ModalTitle = styled.div`\n  font-family: 'Biko';\n  font-size: 30px;\n  line-height: 30px;\n  margin-bottom: 10px;\n  font-weight: 600;\n`;\n\nexport const ModalContent = styled.div`\n  font-family: 'Source Sans Pro';\n  text-align: center;\n  line-height: 25px;\n  font-size: 18px;\n  margin-top: 10px;\n  margin-bottom: 30px;\n`;\n","/* eslint-disable react/jsx-props-no-spreading */\nimport React, { PropsWithChildren } from 'react';\nimport Modal from 'react-modal';\nimport { useTranslation } from 'react-i18next';\nimport Button from 'components/Button';\n\n// Style\nimport {\n  ModalBody, ModalTitle, ModalContent,\n} from './style';\n\nexport interface ConfirmationModalProps {\n  isOpen: boolean;\n  modalTitle: string;\n  onConfirm?: () => void;\n}\n\nModal.setAppElement('#root');\n\nconst RecordErrorModal = React.memo(({\n  modalTitle,\n  children,\n  onConfirm,\n  ...props\n}: PropsWithChildren<ConfirmationModalProps>) => {\n  // Handlers\n\n  const { t } = useTranslation();\n\n  const customStyles = {\n    content: {\n      height: '281px',\n      maxWidth: '348px',\n      margin: 'auto',\n      borderRadius: '10px',\n      border: 'none',\n    },\n    overlay: { backgroundColor: 'rgba(0, 0, 0, 0.5)' },\n  };\n\n  return (\n    <Modal\n      {...props}\n      style={customStyles}\n    >\n      <ModalBody className=\"ModalBody\">\n        <ModalTitle>{modalTitle}</ModalTitle>\n        <ModalContent>{children}</ModalContent>\n        <Button onClick={onConfirm} dark>\n          {t('recordingsIntroduction:retryButton', 'Retry')}\n        </Button>\n      </ModalBody>\n    </Modal>\n  );\n});\n\nexport default RecordErrorModal;\n","export default __webpack_public_path__ + \"static/media/start.e0d4d3a6.svg\";","import styled from 'styled-components';\nimport { colors } from 'theme';\n\nexport const MicRecorderContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: flex-start;\n`;\n\nexport const MicButtonsContainer = styled.div`\n  display:flex;\n  justify-content: space-between;\n  width: 144px;\n  margin: auto;\n`;\n\nexport const MicButtonWithText = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\n\nexport const MicNote = styled.p`\n  font-size: 14px;\n  color: ${colors.lightDarkGray};\n  margin-top: 8px;\n  margin-bottom: 0px;\n`;\nexport const MicRecorderButton = styled.button<{ disabled?: boolean; opacity?: boolean }>`\n  background-color: ${colors.purple};\n  width: 56px;\n  height: 56px;\n  position: relative;\n  outline: none !important;\n  border: none;\n  border-radius: 50%;\n  padding: 0;\n  transition: background-color 0.25s;\n  opacity: ${props => (props.disabled || props.opacity ? '0.5' : '1')};\n\n  @supports not (-webkit-touch-callout: none) {\n    /* CSS for other than iOS devices */\n    -webkit-tap-highlight-color: transparent;\n  }\n\n  &:active {\n    background-color: ${colors.purple};\n  }\n\n  &:before {\n    content: '';\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background-color: transparent;\n    z-index: 1;\n    border-radius: 50%;\n  }\n\n  @media screen and (${props => props.theme.breakpoints.tablet}) {\n    width: 66px;\n    height: 66px;\n  }\n`;\n\nexport const MicRecorderImage = styled.img`\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  transition: opacity 0.25s;\n`;\n\nexport const MicRecorderStartImage = styled(MicRecorderImage)`\n  width: 27px;\n  height: 27px;\n`;\n\nexport const MicRecorderStopImage = styled(MicRecorderImage)`\n  width: 15px;\n  height: 15px;\n`;\n\nexport const MicRecorderTimerContainer = styled.div`\n  width: 70px;\n  height: 41px;\n  font-size: 1.25rem;\n  color: ${colors.purple};\n  font-weight: bold;\n  font-family: 'Source Sans Pro';\n  border: 1px solid ${colors.purple};\n  border-radius: 15px;\n  display: flex; \n  align-items: center; \n  justify-content: center; \n  margin-bottom: 28px;\n\n  @media screen and (${props => props.theme.breakpoints.tablet}) {\n    font-size: 1.75rem;\n    margin-top: 22px;\n  }\n`;\n\nexport const MicRecorderTimerReleaseTextContainer = styled.div`\n  font-size: 16px;\n  line-height: 20px;\n  color: ${colors.red};\n  font-family: 'Source Sans Pro';\n  display: flex; \n  margin-left: 20px;\n  margin-top:10px;\n`;\n\nexport const MicRecorderTextP = styled.p<{ show?: boolean }>`\n  visibility: ${props => (props.show ? 'flex' : 'hidden')};\n`;\n","/* eslint-disable react/require-default-props */\n/* eslint-disable jsx-a11y/click-events-have-key-events */\n/* eslint-disable jsx-a11y/no-static-element-interactions */\nimport React from 'react';\nimport Timer from 'react-compound-timer';\nimport { useTranslation } from 'react-i18next';\n\n// Utils\nimport RecorderService from 'helper/audio/RecorderService';\nimport FileHelper from 'helper/fileHelper';\nimport { getDuration } from 'helper/getDuration';\n\n// Modals\nimport RecordErrorModal from 'modals/RecordErrorModal';\n\n// Images\nimport StartSVG from 'assets/icons/start.svg';\nimport StopSVG from 'assets/icons/stop.svg';\n\n// Styles\nimport {\n  MicRecorderContainer,\n  MicRecorderButton,\n  MicRecorderStartImage,\n  MicRecorderStopImage,\n  MicRecorderTimerContainer,\n  MicRecorderTimerReleaseTextContainer,\n  MicRecorderTextP,\n  MicButtonsContainer,\n  MicNote,\n  MicButtonWithText,\n} from './style';\n\ninterface MicRecorderProps {\n  className?: string;\n  maxTimeInSeconds?: number;\n  onNewRecord: (file: File, humanReadableSize: string) => void;\n  delay?: number;\n  recordingFile: any;\n}\n\nconst baseConfig = {\n  usingMediaRecorder: false,\n  sampleRate: 48000,\n  manualEncoderId: 'wav', // wav / mp3 / flac\n  processorBufferSize: 2048, // 4096 flac / 2048 wav\n};\n\nexport interface RecorderServiceType {\n  config: {\n    broadcastAudioProcessEvents: boolean; // default: false\n    createAnalyserNode: boolean; // default: false\n    createDynamicsCompressorNode: boolean; // default: false\n    forceScriptProcessor: false; // default: false\n    manualEncoderId: string; // default: 'wav'\n    micGain: number; // default: 1.0\n    processorBufferSize: number; // default: 2048\n    stopTracksAndCloseCtxWhenFinished: boolean; // default: true\n    usingMediaRecorder: boolean; // default: typeof window.MediaRecorder !== 'undefined'\n    enableEchoCancellation: boolean; // default: true\n    sampleRate: number; // default: 44100\n  };\n  em: DocumentFragment;\n  startRecording: (timeslice?: number) => Promise<void>;\n  stopRecording: () => void;\n  cleanup: () => void;\n}\n\nconst MicRecorder = ({\n  className = '',\n  maxTimeInSeconds = 30, // 30 segs\n  onNewRecord,\n  delay = 500, // 500ms\n  recordingFile,\n}: MicRecorderProps) => {\n  // Hooks\n  const { t } = useTranslation();\n\n  // Refs\n  const recordingService = React.useRef<RecorderServiceType>();\n  const audioSamples = React.useRef<number>(0);\n  const timerRef = React.useRef<any>();\n  const timeout = React.useRef<NodeJS.Timeout>();\n  const target = React.useRef<HTMLButtonElement>();\n\n  // States\n  const [micAllowed, setMicAllowed] = React.useState<boolean>(true);\n  const [recordingInProgress, setRecordingInProgress] = React.useState<boolean>();\n  const [showReleaseText, setShowReleaseText] = React.useState<boolean>(false);\n  const [showShortRecordingText, setShowShortRecordingText] = React.useState<boolean>(false);\n  const [longPressTriggered, setLongPressTriggered] = React.useState<boolean>(false);\n\n  // Handlers\n  const onAudioProcess = React.useCallback((e: any) => {\n    audioSamples.current += 1;\n    const { inputBuffer, outputBuffer } = e.detail;\n    for (let channel = 0; channel < outputBuffer.numberOfChannels; channel += 1) {\n      const inputData = inputBuffer.getChannelData(channel);\n      const outputData = outputBuffer.getChannelData(channel);\n      // Each sample\n      for (let sample = 0; sample < inputBuffer.length; sample += 1) {\n        outputData[sample] = inputData[sample];\n      }\n    }\n  }, []);\n\n  const onNewRecording = React.useCallback(async (e: any) => {\n    const { detail } = e;\n    const { recording } = detail;\n    const blob = await fetch(recording.blobUrl).then(r => r.blob());\n    const fileName = `Filename.${baseConfig.manualEncoderId}`;\n\n    const file = FileHelper.blobToFile(blob, fileName);\n    const humanReadableSize = FileHelper.sizeAsHuman(file.size, true);\n\n    onNewRecord(file, humanReadableSize);\n  }, [onNewRecord]);\n\n  // Effects\n  React.useEffect(() => {\n    recordingService.current = new RecorderService({\n      ...baseConfig,\n      onRecording: onNewRecording,\n      onAudioProcesss: onAudioProcess,\n    }) as RecorderServiceType;\n\n    const userMediaConstraints = {\n      audio: {\n        echoCancellation: recordingService.current.config.enableEchoCancellation,\n      },\n    };\n    navigator.mediaDevices.getUserMedia(userMediaConstraints)\n      .then(() => {\n        setMicAllowed(true);\n      })\n      .catch(() => {\n        setMicAllowed(false);\n      });\n\n    if (recordingFile) {\n      const file = recordingFile as File;\n      if (file.size) {\n        const audio = new Audio(URL.createObjectURL(file));\n        audio.load();\n        const listenerFn = async () => {\n          audio.removeEventListener('loadedmetadata', listenerFn);\n          getDuration(audio, true).then(result => {\n            timerRef.current?.setTime(result * 1000);\n          });\n        };\n        audio.addEventListener('loadedmetadata', listenerFn);\n      }\n    }\n\n    return () => {\n      if (recordingService.current) {\n        recordingService.current.cleanup();\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Handlers\n  const handleStartRecording = React.useCallback(() => {\n    if (recordingService.current) {\n      audioSamples.current = 0;\n      recordingService.current\n        .startRecording()\n        .then(() => {\n          setRecordingInProgress(true);\n          setShowShortRecordingText(false);\n          if (timerRef.current) {\n            timerRef.current.reset();\n            timerRef.current?.setTime(0);\n            timerRef.current.start();\n          }\n        })\n        .catch((error: any) => console.error('ERROR', error));\n    }\n  }, []);\n\n  const handleStopRecording = React.useCallback(() => {\n    if (recordingService.current) {\n      recordingService.current.stopRecording();\n      setRecordingInProgress(false);\n      if (timerRef.current) {\n        if (timerRef.current.getTime() / 1000 < 2) {\n          setShowShortRecordingText(true);\n        }\n        timerRef.current.stop();\n      }\n    }\n  }, []);\n\n  const handleFormatValue = React.useCallback((value: number) => (value < 10 ? `0${value}` : value), []);\n\n  const preventDefault = (event: any) => {\n    if (!('touches' in event)) event.preventDefault();\n  };\n\n  const handleStartLongPress = React.useCallback(\n    event => {\n      if (event.target) {\n        event.target.addEventListener('touchend', preventDefault, {\n          passive: false,\n        });\n        target.current = event.target;\n      }\n      timeout.current = setTimeout(() => {\n        setShowReleaseText(true);\n        setLongPressTriggered(true);\n        setShowShortRecordingText(false);\n      }, delay);\n    },\n    [delay],\n  );\n\n  const handleEndLongPress = React.useCallback(() => {\n    if (timeout.current) {\n      clearTimeout(timeout.current);\n    }\n    if (longPressTriggered) {\n      setShowReleaseText(false);\n    }\n    setLongPressTriggered(false);\n    if (target.current) {\n      target.current.removeEventListener('touchend', preventDefault);\n    }\n  },\n  [longPressTriggered]);\n\n  return (\n    <MicRecorderContainer className={className}>\n      <MicRecorderTimerReleaseTextContainer>\n        {!showShortRecordingText\n          && (\n            <MicRecorderTextP\n              show={showReleaseText}\n            >\n              {recordingInProgress ? t('recordingsIntroduction:releaseButtonStop') : t('recordingsIntroduction:releaseButtonStart')}\n            </MicRecorderTextP>\n          )}\n        <RecordErrorModal\n          isOpen={showShortRecordingText}\n          modalTitle=\"Oops.\"\n          onConfirm={handleStartRecording}\n        >\n          {t('recordingsIntroduction:shortRecording')}\n        </RecordErrorModal>\n      </MicRecorderTimerReleaseTextContainer>\n      <MicRecorderTimerContainer>\n        <Timer\n          ref={timerRef}\n          startImmediately={false}\n          checkpoints={[\n            {\n              time: maxTimeInSeconds * 1000,\n              callback: handleStopRecording,\n            },\n          ]}\n        >\n          <Timer.Minutes />\n          :\n          <Timer.Seconds formatValue={handleFormatValue} />\n        </Timer>\n      </MicRecorderTimerContainer>\n      <MicButtonsContainer>\n        <MicButtonWithText>\n          <MicRecorderButton\n            disabled={!micAllowed || recordingInProgress}\n            onClick={handleStartRecording}\n            onMouseDown={handleStartLongPress}\n            onMouseUp={handleEndLongPress}\n            onTouchStart={handleStartLongPress}\n            onTouchEnd={handleEndLongPress}\n            onMouseLeave={handleEndLongPress}\n          >\n            <MicRecorderStartImage\n              src={StartSVG}\n              alt=\"Start\"\n            />\n          </MicRecorderButton>\n          <MicNote>{t('recordingsIntroduction:recordCough.record')}</MicNote>\n        </MicButtonWithText>\n        <MicButtonWithText>\n          <MicRecorderButton\n            disabled={!micAllowed || !recordingInProgress}\n            onClick={handleStopRecording}\n            onMouseDown={handleStartLongPress}\n            onMouseUp={handleEndLongPress}\n            onTouchStart={handleStartLongPress}\n            onTouchEnd={handleEndLongPress}\n            onMouseLeave={handleEndLongPress}\n          >\n            <MicRecorderStopImage\n              src={StopSVG}\n              alt=\"Stop\"\n            />\n          </MicRecorderButton>\n          <MicNote>{t('recordingsIntroduction:recordCough.stop')}</MicNote>\n        </MicButtonWithText>\n      </MicButtonsContainer>\n    </MicRecorderContainer>\n  );\n};\n\nexport default React.memo(MicRecorder);\n","export default __webpack_public_path__ + \"static/media/upload.21eec1c7.svg\";","import React from 'react';\nimport usePortal from 'react-useportal';\nimport { useTranslation } from 'react-i18next';\n\n// Form\nimport { Controller, useForm } from 'react-hook-form';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport * as Yup from 'yup';\n\n// Components\nimport MicRecorder from 'components/MicRecorder';\nimport WizardButtons from 'components/WizardButtons';\n\n// Images\nimport UploadSVG from 'assets/icons/upload.svg';\n\n// Styles\nimport {\n  MainContainer,\n  UploadContainer,\n  UploadImage,\n  UploadText,\n  MicContainer,\n} from './style';\n\nconst audioMaxSizeInMb = 5;\n\nconst schema = Yup.object({\n  recordingFile: Yup.mixed()\n    .required('ERROR.FILE_REQUIRED')\n    .test('fileSize', 'ERROR.FILE_SIZE', (value?: any) => {\n      if (value) {\n        const file = value as File;\n        const { size } = file;\n        return (size <= 1024 ** 3 * audioMaxSizeInMb);\n      }\n      return !!value;\n    })\n    .test('fileDuration', 'ERROR.FILE_DURATION', async (value?: any) => {\n      if (value) {\n        const file = value as File;\n        const audio = new Audio(URL.createObjectURL(file));\n        audio.load();\n        await new Promise(resolver => audio.addEventListener('loadedmetadata', resolver));\n        const duration: number = await new Promise(resolver => {\n          if (audio.duration !== Infinity) {\n            resolver(audio.duration);\n          }\n          audio.addEventListener('durationchange', () => {\n            audio.remove();\n            resolver(audio.duration);\n          });\n          audio.volume = 0;\n          audio.currentTime = 24 * 60 * 60; // Unprobable time\n          audio.play();\n        });\n        return (duration >= 2);\n      }\n      return !!value;\n    }),\n}).defined();\n\nexport type RecordType = Yup.InferType<typeof schema>;\n\ninterface RecordProps {\n  onNext: (values: RecordType) => void,\n  onManualUpload: () => void,\n  defaultValues: RecordType,\n  currentLogic: string,\n  action:any,\n}\n\nconst Record = ({\n  onNext,\n  onManualUpload,\n  defaultValues,\n  currentLogic,\n  action,\n}: RecordProps) => {\n  // Hooks\n  const { Portal } = usePortal({\n    bindTo:\n      document && (document.getElementById('wizard-buttons') as HTMLDivElement),\n  });\n  const {\n    handleSubmit, control, getValues, formState,\n  } = useForm({\n    mode: 'onChange',\n    defaultValues,\n    resolver: yupResolver(schema),\n  });\n  const { t } = useTranslation();\n\n  const { isValid } = formState;\n\n  // Refs\n  const micKey = React.useRef<number>(1);\n\n  const onManualUploadWithFile = () => {\n    action({\n      [currentLogic]: {\n        recordingFile: getValues('recordingFile') || null,\n        uploadedFile: null,\n      },\n    });\n    onManualUpload?.();\n  };\n\n  return (\n    <>\n      <MainContainer>\n        <MicContainer>\n          <Controller\n            control={control}\n            name=\"recordingFile\"\n            render={({ onChange }) => (\n              <MicRecorder\n                key={micKey.current} // On delete, easy re-mount a new mic recorder\n                onNewRecord={onChange}\n                recordingFile={defaultValues?.recordingFile}\n              />\n            )}\n          />\n        </MicContainer>\n\n        <Portal>\n          <WizardButtons\n            invert\n            leftLabel={t('recordingsRecord:next')}\n            leftDisabled={!isValid}\n            leftHandler={handleSubmit(onNext)}\n          />\n          {/* Upload Container */}\n          <UploadContainer onClick={onManualUploadWithFile}>\n            <UploadImage src={UploadSVG} />\n            <UploadText>{t('recordingsRecord:upload')}</UploadText>\n          </UploadContainer>\n        </Portal>\n      </MainContainer>\n    </>\n  );\n};\n\nexport default React.memo(Record);\n","export default __webpack_public_path__ + \"static/media/stop.e6f44abd.svg\";","import styled from 'styled-components';\nimport { BlackText } from 'components/Texts';\nimport { colors } from 'theme';\n\nimport StopSVG from 'assets/icons/stop.svg';\n\nexport const MainContainer = styled.div`\n  padding: 0px 0px;\n`;\n\nexport const Text = styled(BlackText)`\n  color: ${props => props.theme.colors.darkBlack};\n  margin-bottom: 2px;\n  text-align: left;\n\n  @media screen and (${props => props.theme.breakpoints.tablet}){\n    max-width: 470px;\n    margin: 0 auto;\n    font-size: 16px;\n  }\n\n  @media screen and (${props => props.theme.breakpoints.tablet}){\n    @media (orientation: portrait) {\n      margin-bottom: 248px;\n    }\n\n    @media (orientation: landscape) {\n      margin-bottom: 24px;\n    }\n  }\n`;\n\nexport const MicContainer = styled.div``;\n\nexport const UploadContainer = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0px 20px;\n  margin: 20px auto;\n  width: fit-content;\n\n\n  @media screen and (${props => props.theme.breakpoints.tablet}){\n    padding: 0px 22px;\n    margin: 22px auto;\n  }\n`;\n\nexport const UploadImage = styled.img`\n  cursor: pointer;\n  width: 13px;\n  height: 12px;\n  margin-right: 7px;\n`;\n\nexport const UploadText = styled.div`\n  cursor: pointer;\n  font-family: Source Sans Pro;\n  font-weight: bold;\n  font-size: 0.75rem;\n  line-height: 24px;\n  color: ${colors.darkBlack};\n`;\n\nexport const StopImg = styled.img.attrs(() => ({ src: StopSVG }))`\n  display: inline;\n  height: 10px;\n  margin: 0px 2px 4px;\n`;\n","/* eslint-disable no-plusplus */\n/* eslint-disable no-param-reassign */\n\nconst sizeAsHuman = (bytes: number, si?: boolean) => {\n  const thresh = si ? 1000 : 1024;\n  if (Math.abs(bytes) < thresh) {\n    return `${bytes} B`;\n  }\n  const units = si\n    ? ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\n    : ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'];\n  let u = -1;\n  do {\n    bytes /= thresh;\n    ++u;\n  } while (Math.abs(bytes) >= thresh && u < units.length - 1);\n  return `${bytes.toFixed(1)} ${units[u]}`;\n};\n\nconst blobToFile = (theBlob: Blob, fileName:string): File => {\n  const b: any = theBlob;\n  // A Blob() is almost a File() - it's just missing the two properties below which we will add\n  b.lastModifiedDate = new Date();\n  b.name = fileName;\n\n  // Cast to a File() type\n  return theBlob as File;\n};\n\nexport default {\n  sizeAsHuman,\n  blobToFile,\n};\n","import { isSafari } from 'react-device-detect';\n\nexport function getDuration(e: HTMLAudioElement, remove?: boolean): Promise<number> {\n  return new Promise(resolver => {\n    if (e.duration !== Infinity\n        && (!isSafari\n        || (isSafari && e.duration > 0))) {\n      resolver(e.duration);\n      return;\n    }\n    e.addEventListener('durationchange', () => {\n      if (remove) {\n        e.remove();\n      } else {\n        e.pause();\n        e.volume = 1;\n        e.currentTime = 0;\n      }\n      resolver(e.duration);\n    });\n    e.currentTime = 24 * 60 * 60; // Unprobable time\n    e.play();\n  });\n}\n"],"sourceRoot":""}